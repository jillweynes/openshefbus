import{S as V,i as C,s as H,k as y,q as N,l as $,m as T,r as F,h as _,n as U,b as k,G as b,u as G,H as z,a as M,c as R,p as Y,J as B,g as P,v as K,f as x,d as j,K as J,L as ae,M as O,y as ce,z as ue,A as fe,B as he,N as X}from"../chunks/index.855b6ba5.js";function me(s){let e,l,t=s[0].rtname+"",n,a,o=s[0].depname+"",i;return{c(){e=y("div"),l=y("p"),n=N(t),a=N(" from "),i=N(o),this.h()},l(c){e=$(c,"DIV",{class:!0});var d=T(e);l=$(d,"P",{});var f=T(l);n=F(f,t),a=F(f," from "),i=F(f,o),f.forEach(_),d.forEach(_),this.h()},h(){U(e,"class","svelte-fjfd5m")},m(c,d){k(c,e,d),b(e,l),b(l,n),b(l,a),b(l,i)},p(c,[d]){d&1&&t!==(t=c[0].rtname+"")&&G(n,t),d&1&&o!==(o=c[0].depname+"")&&G(i,o)},i:z,o:z,d(c){c&&_(e)}}}function ge(s,e,l){let{bus:t}=e;return s.$$set=n=>{"bus"in n&&l(0,t=n.bus)},[t]}class _e extends V{constructor(e){super(),C(this,e,ge,me,H,{bus:0})}}function ve(s){let e,l,t,n,a;return{c(){e=y("input"),l=M(),t=y("div"),this.h()},l(o){e=$(o,"INPUT",{type:!0}),l=R(o),t=$(o,"DIV",{id:!0,style:!0,class:!0}),T(t).forEach(_),this.h()},h(){U(e,"type","button"),e.value="Refresh",U(t,"id","map"),Y(t,"height","900px"),Y(t,"width","100%"),U(t,"class","svelte-116milu")},m(o,i){k(o,e,i),k(o,l,i),k(o,t,i),n||(a=B(e,"click",s[0]),n=!0)},p:z,i:z,o:z,d(o){o&&_(e),o&&_(l),o&&_(t),n=!1,a()}}}function we(s,e,l){let t=[],n=[],a=null,o=null,i=null,c=null,d=null,f=null,S=null,u=[];async function h(){console.log("refreshBusData"),w(),console.log("RM"),g(),console.log("Loc"),D(),console.log("LocS"),q(),console.log("User Loc")}async function r(){for(let p=0;p<n.length;p++)a.removeLayer(n[p]);n=[],g(),q()}function D(){for(let p=0;p<t.length;p++){let I=t[p].deploc.trim().split("      ");L.marker([I[0].trim(),I[1].trim()],{icon:i}).addTo(a).bindPopup("Start "+t[p].depname),I=t[p].arrloc.trim().split("      "),L.marker([I[0].trim(),I[1].trim()],{icon:o}).addTo(a).bindPopup("End "+t[p].arrname)}}async function w(){for(let p=0;p<t.length;p++){let I=await fetch(S+"/route/"+t[p].rtname),{data:E}=await I.json();m(E)}}function m(p){for(let A=0;A<p.length;A++){var I=new Array("blue","black"),E=I[0];L.polyline(p[A]).addTo(a).setStyle({color:E})}}async function g(){for(let p=0;p<t.length;p++){let I=await fetch(S+"/data/"+t[p].rtname),{data:E}=await I.json();v(E,t[p].rtname,t[p].bound)}}function v(p,I,E){for(let A=0;A<p.length-1;A++){let Q=parseFloat(p[A].lat),W=parseFloat(p[A].lon);E.trim().toUpperCase()=="UNKNOWN"?n.push(L.marker([Q,W],{icon:f}).addTo(a).bindPopup("A "+I+" bus with "+p[A].id+" direction "+p[A].bound+`
. inbound or outbound could not be determined from google maps`)):p[A].bound.trim().toUpperCase()==E.trim().toUpperCase()&&n.push(L.marker([Q,W],{icon:d}).addTo(a).bindPopup("A "+I+" bus with "+p[A].id))}}function q(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{u=[p.coords.latitude,p.coords.longitude],pe()})}function pe(){n.push(L.marker([u[0],u[1]],{icon:c}).addTo(a).bindPopup("Your Location").openPopup())}function de(p){console.log("load map"),S=p.host,t=p.r,a=L.map("map").setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),c=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/location-dot.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),o=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-arrival.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),i=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-departure.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),d=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/43432/tick.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),f=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/510152/question.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),h()}return[r,h,de]}class be extends V{constructor(e){super(),C(this,e,we,ve,H,{refreshBusData:1,refreshLocationData:0,load:2})}get refreshBusData(){return this.$$.ctx[1]}get refreshLocationData(){return this.$$.ctx[0]}get load(){return this.$$.ctx[2]}}function Z(s,e,l){const t=s.slice();return t[6]=e[l],t}function ee(s,e,l){const t=s.slice();return t[9]=e[l],t}function te(s){let e,l;return e=new _e({props:{bus:s[9]}}),{c(){ce(e.$$.fragment)},l(t){ue(e.$$.fragment,t)},m(t,n){fe(e,t,n),l=!0},p(t,n){const a={};n&1&&(a.bus=t[9]),e.$set(a)},i(t){l||(P(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){he(e,t)}}}function oe(s){let e,l,t,n,a,o,i,c,d=s[6].r,f=[];for(let u=0;u<d.length;u+=1)f[u]=te(ee(s,d,u));const S=u=>j(f[u],1,1,()=>{f[u]=null});return{c(){e=y("div"),l=y("p"),t=N("Route:"),n=M();for(let u=0;u<f.length;u+=1)f[u].c();a=M(),this.h()},l(u){e=$(u,"DIV",{class:!0});var h=T(e);l=$(h,"P",{class:!0});var r=T(l);t=F(r,"Route:"),r.forEach(_),n=R(h);for(let D=0;D<f.length;D+=1)f[D].l(h);a=R(h),h.forEach(_),this.h()},h(){U(l,"class","svelte-ppqq2x"),U(e,"class","svelte-ppqq2x")},m(u,h){k(u,e,h),b(e,l),b(l,t),b(e,n);for(let r=0;r<f.length;r+=1)f[r]&&f[r].m(e,null);b(e,a),o=!0,i||(c=[B(e,"click",function(){ae(s[1](s[6]))&&s[1](s[6]).apply(this,arguments)}),B(e,"keypress",{})],i=!0)},p(u,h){if(s=u,h&1){d=s[6].r;let r;for(r=0;r<d.length;r+=1){const D=ee(s,d,r);f[r]?(f[r].p(D,h),P(f[r],1)):(f[r]=te(D),f[r].c(),P(f[r],1),f[r].m(e,a))}for(K(),r=d.length;r<f.length;r+=1)S(r);x()}},i(u){if(!o){for(let h=0;h<d.length;h+=1)P(f[h]);o=!0}},o(u){f=f.filter(Boolean);for(let h=0;h<f.length;h+=1)j(f[h]);o=!1},d(u){u&&_(e),J(f,u),i=!1,O(c)}}}function ye(s){let e,l,t=s[0],n=[];for(let o=0;o<t.length;o+=1)n[o]=oe(Z(s,t,o));const a=o=>j(n[o],1,1,()=>{n[o]=null});return{c(){e=y("div");for(let o=0;o<n.length;o+=1)n[o].c();this.h()},l(o){e=$(o,"DIV",{class:!0});var i=T(e);for(let c=0;c<n.length;c+=1)n[c].l(i);i.forEach(_),this.h()},h(){U(e,"class","svelte-ppqq2x")},m(o,i){k(o,e,i);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);l=!0},p(o,[i]){if(i&3){t=o[0];let c;for(c=0;c<t.length;c+=1){const d=Z(o,t,c);n[c]?(n[c].p(d,i),P(n[c],1)):(n[c]=oe(d),n[c].c(),P(n[c],1),n[c].m(e,null))}for(K(),c=t.length;c<n.length;c+=1)a(c);x()}},i(o){if(!l){for(let i=0;i<t.length;i+=1)P(n[i]);l=!0}},o(o){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)j(n[i]);l=!1},d(o){o&&_(e),J(n,o)}}}function $e(s,e,l){let t=[],n=[],a="",o="";async function i(d){console.log("Start Load"),o=d.host,n=d.location,a=d.destination;let f=await fetch(o+"/dirs/?home="+n[0]+","+n[1]+"&dest="+a),{data:S}=await f.json();l(0,t=S)}async function c(d){console.log("here");var f=new be({target:document.querySelector("#Map")});console.log("here2"),f.load({host:o,r:d.r}),console.log("here3"),l(0,t=[d])}return[t,c,i]}class Le extends V{constructor(e){super(),C(this,e,$e,ye,H,{load:2})}get load(){return this.$$.ctx[2]}}function ke(s){let e,l=s[0].name+"",t;return{c(){e=y("p"),t=N(l),this.h()},l(n){e=$(n,"P",{class:!0});var a=T(e);t=F(a,l),a.forEach(_),this.h()},h(){U(e,"class","svelte-sx44t9")},m(n,a){k(n,e,a),b(e,t)},p(n,[a]){a&1&&l!==(l=n[0].name+"")&&G(t,l)},i:z,o:z,d(n){n&&_(e)}}}function Se(s,e,l){let{destination:t}=e;return s.$$set=n=>{"destination"in n&&l(0,t=n.destination)},[t]}class Ie extends V{constructor(e){super(),C(this,e,Se,ke,H,{destination:0})}}function ne(s,e,l){const t=s.slice();return t[3]=e[l],t}function le(s){let e,l,t,n,a;return{c(){e=y("input"),l=M(),t=y("input"),this.h()},l(o){e=$(o,"INPUT",{type:!0}),l=R(o),t=$(o,"INPUT",{type:!0}),this.h()},h(){U(e,"type","text"),U(t,"type","button"),t.value="Search"},m(o,i){k(o,e,i),X(e,s[2]),k(o,l,i),k(o,t,i),n||(a=[B(e,"input",s[7]),B(t,"click",s[5])],n=!0)},p(o,i){i&4&&e.value!==o[2]&&X(e,o[2])},d(o){o&&_(e),o&&_(l),o&&_(t),n=!1,O(a)}}}function se(s){let e,l,t,n,a;return l=new Ie({props:{destination:s[3]}}),{c(){e=y("div"),ce(l.$$.fragment)},l(o){e=$(o,"DIV",{});var i=T(e);ue(l.$$.fragment,i),i.forEach(_)},m(o,i){k(o,e,i),fe(l,e,null),t=!0,n||(a=[B(e,"click",function(){ae(s[4](s[3]))&&s[4](s[3]).apply(this,arguments)}),B(e,"keypress",{})],n=!0)},p(o,i){s=o;const c={};i&2&&(c.destination=s[3]),l.$set(c)},i(o){t||(P(l.$$.fragment,o),t=!0)},o(o){j(l.$$.fragment,o),t=!1},d(o){o&&_(e),he(l),n=!1,O(a)}}}function ie(s){let e,l,t,n,a;return{c(){e=y("input"),l=M(),t=y("input"),this.h()},l(o){e=$(o,"INPUT",{type:!0}),l=R(o),t=$(o,"INPUT",{type:!0}),this.h()},h(){U(e,"type","button"),e.value="Change Location",U(t,"type","button"),t.value="Reload Routes"},m(o,i){k(o,e,i),k(o,l,i),k(o,t,i),n||(a=[B(e,"click",Ae),B(t,"click",s[6])],n=!0)},p:z,d(o){o&&_(e),o&&_(l),o&&_(t),n=!1,O(a)}}}function Ue(s){let e,l,t,n,a,o,i,c,d,f,S,u=s[0]==0&&le(s),h=s[1],r=[];for(let m=0;m<h.length;m+=1)r[m]=se(ne(s,h,m));const D=m=>j(r[m],1,1,()=>{r[m]=null});let w=s[0]==1&&ie(s);return{c(){e=y("main"),l=y("h1"),t=N("Open Shef Bus"),n=M(),u&&u.c(),a=M();for(let m=0;m<r.length;m+=1)r[m].c();o=M(),w&&w.c(),i=M(),c=y("div"),d=M(),f=y("div"),this.h()},l(m){e=$(m,"MAIN",{});var g=T(e);l=$(g,"H1",{});var v=T(l);t=F(v,"Open Shef Bus"),v.forEach(_),n=R(g),u&&u.l(g),a=R(g);for(let q=0;q<r.length;q+=1)r[q].l(g);o=R(g),w&&w.l(g),i=R(g),c=$(g,"DIV",{id:!0}),T(c).forEach(_),d=R(g),f=$(g,"DIV",{id:!0}),T(f).forEach(_),g.forEach(_),this.h()},h(){U(c,"id","Rts"),U(f,"id","Map")},m(m,g){k(m,e,g),b(e,l),b(l,t),b(e,n),u&&u.m(e,null),b(e,a);for(let v=0;v<r.length;v+=1)r[v]&&r[v].m(e,null);b(e,o),w&&w.m(e,null),b(e,i),b(e,c),b(e,d),b(e,f),S=!0},p(m,[g]){if(m[0]==0?u?u.p(m,g):(u=le(m),u.c(),u.m(e,a)):u&&(u.d(1),u=null),g&18){h=m[1];let v;for(v=0;v<h.length;v+=1){const q=ne(m,h,v);r[v]?(r[v].p(q,g),P(r[v],1)):(r[v]=se(q),r[v].c(),P(r[v],1),r[v].m(e,o))}for(K(),v=h.length;v<r.length;v+=1)D(v);x()}m[0]==1?w?w.p(m,g):(w=ie(m),w.c(),w.m(e,i)):w&&(w.d(1),w=null)},i(m){if(!S){for(let g=0;g<h.length;g+=1)P(r[g]);S=!0}},o(m){r=r.filter(Boolean);for(let g=0;g<r.length;g+=1)j(r[g]);S=!1},d(m){m&&_(e),u&&u.d(),J(r,m),w&&w.d()}}}let re="http://localhost:4567";function Ae(){document.location.reload()}function Te(s,e,l){let t=0,n=[],a=[],o="",i="";function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(h=>{a=[h.coords.latitude,h.coords.longitude];var r=new Le({target:document.querySelector("#Rts")});r.load({host:re,location:a,destination:o}),l(0,t=1)}):alert("Geolocation is not supported by this browser.")}function d(h){l(3,o=h.id),console.log(h.id),l(1,n=[h]),c()}async function f(){let h=await fetch(re+"/search/?dest="+i),{data:r}=await h.json();l(1,n=r)}function S(){document.querySelector("#Rts").innerHTML="",console.log("cleared"),c(),document.querySelector("#Map").innerHTML=""}function u(){i=this.value,l(2,i)}return[t,n,i,o,d,f,S,u]}class De extends V{constructor(e){super(),C(this,e,Te,Ue,H,{})}}export{De as default};
