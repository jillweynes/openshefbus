import{S as F,i as V,s as H,k as y,q as N,l as $,m as T,r as C,h as _,n as A,b as k,G as b,u as G,H as B,a as M,c as R,p as x,J as q,g as D,v as K,f as J,d as j,K as Q,L as ae,M as O,y as ce,z as ue,A as fe,B as pe,N as X}from"../chunks/index.855b6ba5.js";function me(s){let e,l,t=s[0].rtname+"",n,a,o=s[0].depname+"",r;return{c(){e=y("div"),l=y("p"),n=N(t),a=N(" from "),r=N(o),this.h()},l(c){e=$(c,"DIV",{class:!0});var h=T(e);l=$(h,"P",{});var u=T(l);n=C(u,t),a=C(u," from "),r=C(u,o),u.forEach(_),h.forEach(_),this.h()},h(){A(e,"class","svelte-fjfd5m")},m(c,h){k(c,e,h),b(e,l),b(l,n),b(l,a),b(l,r)},p(c,[h]){h&1&&t!==(t=c[0].rtname+"")&&G(n,t),h&1&&o!==(o=c[0].depname+"")&&G(r,o)},i:B,o:B,d(c){c&&_(e)}}}function ge(s,e,l){let{bus:t}=e;return s.$$set=n=>{"bus"in n&&l(0,t=n.bus)},[t]}class _e extends F{constructor(e){super(),V(this,e,ge,me,H,{bus:0})}}function ve(s){let e,l,t,n,a;return{c(){e=y("input"),l=M(),t=y("div"),this.h()},l(o){e=$(o,"INPUT",{type:!0}),l=R(o),t=$(o,"DIV",{id:!0,style:!0,class:!0}),T(t).forEach(_),this.h()},h(){A(e,"type","button"),e.value="Refresh",A(t,"id","map"),x(t,"height","900px"),x(t,"width","100%"),A(t,"class","svelte-116milu")},m(o,r){k(o,e,r),k(o,l,r),k(o,t,r),n||(a=q(e,"click",s[0]),n=!0)},p:B,i:B,o:B,d(o){o&&_(e),o&&_(l),o&&_(t),n=!1,a()}}}function we(s,e,l){let t=[],n=[],a=null,o=null,r=null,c=null,h=null,u=null,S=null,f=[];async function d(){console.log("refreshBusData"),w(),console.log("RM"),g(),console.log("Loc"),I(),console.log("LocS"),E(),console.log("User Loc")}async function i(){for(let p=0;p<n.length;p++)a.removeLayer(n[p]);n=[],g(),E()}function I(){for(let p=0;p<t.length;p++){let U=t[p].deploc.trim().split("      ");L.marker([U[0].trim(),U[1].trim()],{icon:r}).addTo(a).bindPopup("Start "+t[p].depname),U=t[p].arrloc.trim().split("      "),L.marker([U[0].trim(),U[1].trim()],{icon:o}).addTo(a).bindPopup("End "+t[p].arrname)}}async function w(){for(let p=0;p<t.length;p++){let U=await fetch(S+"/route/"+t[p].rtname),{data:z}=await U.json();m(z)}}function m(p){for(let P=0;P<p.length;P++){var U=new Array("blue","black"),z=U[0];L.polyline(p[P]).addTo(a).setStyle({color:z})}}async function g(){for(let p=0;p<t.length;p++){let U=await fetch(S+"/data/"+t[p].rtname),{data:z}=await U.json();v(z,t[p].rtname,t[p].bound)}}function v(p,U,z){for(let P=0;P<p.length-1;P++){let W=parseFloat(p[P].lat),Y=parseFloat(p[P].lon);z.trim().toUpperCase()=="UNKNOWN"?n.push(L.marker([W,Y],{icon:u}).addTo(a).bindPopup("A "+U+" bus with "+p[P].id+" direction "+p[P].bound+`
. inbound or outbound could not be determined from google maps`)):p[P].bound.trim().toUpperCase()==z.trim().toUpperCase()&&n.push(L.marker([W,Y],{icon:h}).addTo(a).bindPopup("A "+U+" bus with "+p[P].id))}}function E(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{f=[p.coords.latitude,p.coords.longitude],he()})}function he(){n.push(L.marker([f[0],f[1]],{icon:c}).addTo(a).bindPopup("Your Location").openPopup())}function de(p){console.log("load map"),S=p.host,t=p.r,a=L.map("map").setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),c=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/location-dot.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),o=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-arrival.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),r=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-departure.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),h=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/43432/tick.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),u=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/510152/question.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),d()}return[i,d,de]}class be extends F{constructor(e){super(),V(this,e,we,ve,H,{refreshBusData:1,refreshLocationData:0,load:2})}get refreshBusData(){return this.$$.ctx[1]}get refreshLocationData(){return this.$$.ctx[0]}get load(){return this.$$.ctx[2]}}function Z(s,e,l){const t=s.slice();return t[6]=e[l],t}function ee(s,e,l){const t=s.slice();return t[9]=e[l],t}function te(s){let e,l;return e=new _e({props:{bus:s[9]}}),{c(){ce(e.$$.fragment)},l(t){ue(e.$$.fragment,t)},m(t,n){fe(e,t,n),l=!0},p(t,n){const a={};n&1&&(a.bus=t[9]),e.$set(a)},i(t){l||(D(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){pe(e,t)}}}function oe(s){let e,l,t,n,a,o,r,c,h=s[6].r,u=[];for(let f=0;f<h.length;f+=1)u[f]=te(ee(s,h,f));const S=f=>j(u[f],1,1,()=>{u[f]=null});return{c(){e=y("div"),l=y("p"),t=N("Route:"),n=M();for(let f=0;f<u.length;f+=1)u[f].c();a=M(),this.h()},l(f){e=$(f,"DIV",{class:!0});var d=T(e);l=$(d,"P",{class:!0});var i=T(l);t=C(i,"Route:"),i.forEach(_),n=R(d);for(let I=0;I<u.length;I+=1)u[I].l(d);a=R(d),d.forEach(_),this.h()},h(){A(l,"class","svelte-ppqq2x"),A(e,"class","svelte-ppqq2x")},m(f,d){k(f,e,d),b(e,l),b(l,t),b(e,n);for(let i=0;i<u.length;i+=1)u[i]&&u[i].m(e,null);b(e,a),o=!0,r||(c=[q(e,"click",function(){ae(s[1](s[6]))&&s[1](s[6]).apply(this,arguments)}),q(e,"keypress",{})],r=!0)},p(f,d){if(s=f,d&1){h=s[6].r;let i;for(i=0;i<h.length;i+=1){const I=ee(s,h,i);u[i]?(u[i].p(I,d),D(u[i],1)):(u[i]=te(I),u[i].c(),D(u[i],1),u[i].m(e,a))}for(K(),i=h.length;i<u.length;i+=1)S(i);J()}},i(f){if(!o){for(let d=0;d<h.length;d+=1)D(u[d]);o=!0}},o(f){u=u.filter(Boolean);for(let d=0;d<u.length;d+=1)j(u[d]);o=!1},d(f){f&&_(e),Q(u,f),r=!1,O(c)}}}function ye(s){let e,l,t=s[0],n=[];for(let o=0;o<t.length;o+=1)n[o]=oe(Z(s,t,o));const a=o=>j(n[o],1,1,()=>{n[o]=null});return{c(){e=y("div");for(let o=0;o<n.length;o+=1)n[o].c();this.h()},l(o){e=$(o,"DIV",{class:!0});var r=T(e);for(let c=0;c<n.length;c+=1)n[c].l(r);r.forEach(_),this.h()},h(){A(e,"class","svelte-ppqq2x")},m(o,r){k(o,e,r);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);l=!0},p(o,[r]){if(r&3){t=o[0];let c;for(c=0;c<t.length;c+=1){const h=Z(o,t,c);n[c]?(n[c].p(h,r),D(n[c],1)):(n[c]=oe(h),n[c].c(),D(n[c],1),n[c].m(e,null))}for(K(),c=t.length;c<n.length;c+=1)a(c);J()}},i(o){if(!l){for(let r=0;r<t.length;r+=1)D(n[r]);l=!0}},o(o){n=n.filter(Boolean);for(let r=0;r<n.length;r+=1)j(n[r]);l=!1},d(o){o&&_(e),Q(n,o)}}}function $e(s,e,l){let t=[],n=[],a="",o="";async function r(h){console.log("Start Load"),o=h.host,n=h.location,a=h.destination;let u=await fetch(o+"/dirs/?home="+n[0]+","+n[1]+"&dest="+a),{data:S}=await u.json();l(0,t=S)}async function c(h){console.log("here");var u=new be({target:document.querySelector("#Map")});console.log("here2"),u.load({host:o,r:h.r}),console.log("here3"),l(0,t=[h])}return[t,c,r]}class ke extends F{constructor(e){super(),V(this,e,$e,ye,H,{load:2})}get load(){return this.$$.ctx[2]}}function Le(s){let e,l=s[0].name+"",t;return{c(){e=y("p"),t=N(l),this.h()},l(n){e=$(n,"P",{class:!0});var a=T(e);t=C(a,l),a.forEach(_),this.h()},h(){A(e,"class","svelte-sx44t9")},m(n,a){k(n,e,a),b(e,t)},p(n,[a]){a&1&&l!==(l=n[0].name+"")&&G(t,l)},i:B,o:B,d(n){n&&_(e)}}}function Se(s,e,l){let{destination:t}=e;return s.$$set=n=>{"destination"in n&&l(0,t=n.destination)},[t]}class Ie extends F{constructor(e){super(),V(this,e,Se,Le,H,{destination:0})}}function ne(s,e,l){const t=s.slice();return t[3]=e[l],t}function le(s){let e,l,t,n,a;return{c(){e=y("input"),l=M(),t=y("input"),this.h()},l(o){e=$(o,"INPUT",{type:!0}),l=R(o),t=$(o,"INPUT",{type:!0}),this.h()},h(){A(e,"type","text"),A(t,"type","button"),t.value="Search"},m(o,r){k(o,e,r),X(e,s[2]),k(o,l,r),k(o,t,r),n||(a=[q(e,"input",s[8]),q(e,"keypress",s[7]),q(t,"click",s[5])],n=!0)},p(o,r){r&4&&e.value!==o[2]&&X(e,o[2])},d(o){o&&_(e),o&&_(l),o&&_(t),n=!1,O(a)}}}function se(s){let e,l,t,n,a;return l=new Ie({props:{destination:s[3]}}),{c(){e=y("div"),ce(l.$$.fragment)},l(o){e=$(o,"DIV",{});var r=T(e);ue(l.$$.fragment,r),r.forEach(_)},m(o,r){k(o,e,r),fe(l,e,null),t=!0,n||(a=[q(e,"click",function(){ae(s[4](s[3]))&&s[4](s[3]).apply(this,arguments)}),q(e,"keypress",{})],n=!0)},p(o,r){s=o;const c={};r&2&&(c.destination=s[3]),l.$set(c)},i(o){t||(D(l.$$.fragment,o),t=!0)},o(o){j(l.$$.fragment,o),t=!1},d(o){o&&_(e),pe(l),n=!1,O(a)}}}function ie(s){let e,l,t,n,a;return{c(){e=y("input"),l=M(),t=y("input"),this.h()},l(o){e=$(o,"INPUT",{type:!0}),l=R(o),t=$(o,"INPUT",{type:!0}),this.h()},h(){A(e,"type","button"),e.value="Change Location",A(t,"type","button"),t.value="Reload Routes"},m(o,r){k(o,e,r),k(o,l,r),k(o,t,r),n||(a=[q(e,"click",Ae),q(t,"click",s[6])],n=!0)},p:B,d(o){o&&_(e),o&&_(l),o&&_(t),n=!1,O(a)}}}function Ue(s){let e,l,t,n,a,o,r,c,h,u,S,f=s[0]==0&&le(s),d=s[1],i=[];for(let m=0;m<d.length;m+=1)i[m]=se(ne(s,d,m));const I=m=>j(i[m],1,1,()=>{i[m]=null});let w=s[0]==1&&ie(s);return{c(){e=y("main"),l=y("h1"),t=N("Open Shef Bus"),n=M(),f&&f.c(),a=M();for(let m=0;m<i.length;m+=1)i[m].c();o=M(),w&&w.c(),r=M(),c=y("div"),h=M(),u=y("div"),this.h()},l(m){e=$(m,"MAIN",{});var g=T(e);l=$(g,"H1",{});var v=T(l);t=C(v,"Open Shef Bus"),v.forEach(_),n=R(g),f&&f.l(g),a=R(g);for(let E=0;E<i.length;E+=1)i[E].l(g);o=R(g),w&&w.l(g),r=R(g),c=$(g,"DIV",{id:!0}),T(c).forEach(_),h=R(g),u=$(g,"DIV",{id:!0}),T(u).forEach(_),g.forEach(_),this.h()},h(){A(c,"id","Rts"),A(u,"id","Map")},m(m,g){k(m,e,g),b(e,l),b(l,t),b(e,n),f&&f.m(e,null),b(e,a);for(let v=0;v<i.length;v+=1)i[v]&&i[v].m(e,null);b(e,o),w&&w.m(e,null),b(e,r),b(e,c),b(e,h),b(e,u),S=!0},p(m,[g]){if(m[0]==0?f?f.p(m,g):(f=le(m),f.c(),f.m(e,a)):f&&(f.d(1),f=null),g&18){d=m[1];let v;for(v=0;v<d.length;v+=1){const E=ne(m,d,v);i[v]?(i[v].p(E,g),D(i[v],1)):(i[v]=se(E),i[v].c(),D(i[v],1),i[v].m(e,o))}for(K(),v=d.length;v<i.length;v+=1)I(v);J()}m[0]==1?w?w.p(m,g):(w=ie(m),w.c(),w.m(e,r)):w&&(w.d(1),w=null)},i(m){if(!S){for(let g=0;g<d.length;g+=1)D(i[g]);S=!0}},o(m){i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)j(i[g]);S=!1},d(m){m&&_(e),f&&f.d(),Q(i,m),w&&w.d()}}}let re="https://deploy.thankfulsmoke-89b0f183.northeurope.azurecontainerapps.io";function Ae(){document.location.reload()}function Pe(s,e,l){let t=0,n=[],a=[],o="",r="";function c(){navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{a=[i.coords.latitude,i.coords.longitude];var I=new ke({target:document.querySelector("#Rts")});I.load({host:re,location:a,destination:o}),l(0,t=1)}):alert("Geolocation is not supported by this browser.")}function h(i){l(3,o=i.id),console.log(i.id),l(1,n=[i]),c()}async function u(){let i=await fetch(re+"/search/?dest="+r),{data:I}=await i.json();l(1,n=I)}function S(){document.querySelector("#Rts").innerHTML="",console.log("cleared"),c(),document.querySelector("#Map").innerHTML=""}const f=i=>{i.charCode===13&&u()};function d(){r=this.value,l(2,r)}return[t,n,r,o,h,u,S,f,d]}class De extends F{constructor(e){super(),V(this,e,Pe,Ue,H,{})}}export{De as default};
