import{S as H,i as O,s as G,k as S,q as j,l as I,m as P,r as N,h as _,n as T,b as U,G as k,u as Q,H as C,a as D,c as E,p as x,J as q,g as M,v as W,f as Y,d as F,K as X,L as pe,M as K,y as he,z as de,A as me,B as ge,N as ee}from"../chunks/index.855b6ba5.js";function _e(i){let e,n,t=i[0].rtname+"",l,r,o=i[0].depname+"",c;return{c(){e=S("div"),n=S("p"),l=j(t),r=j(" from "),c=j(o),this.h()},l(a){e=I(a,"DIV",{class:!0});var u=P(e);n=I(u,"P",{});var s=P(n);l=N(s,t),r=N(s," from "),c=N(s,o),s.forEach(_),u.forEach(_),this.h()},h(){T(e,"class","svelte-fjfd5m")},m(a,u){U(a,e,u),k(e,n),k(n,l),k(n,r),k(n,c)},p(a,[u]){u&1&&t!==(t=a[0].rtname+"")&&Q(l,t),u&1&&o!==(o=a[0].depname+"")&&Q(c,o)},i:C,o:C,d(a){a&&_(e)}}}function ve(i,e,n){let{bus:t}=e;return i.$$set=l=>{"bus"in l&&n(0,t=l.bus)},[t]}class be extends H{constructor(e){super(),O(this,e,ve,_e,G,{bus:0})}}function we(i){let e,n,t,l,r;return{c(){e=S("input"),n=D(),t=S("div"),this.h()},l(o){e=I(o,"INPUT",{type:!0}),n=E(o),t=I(o,"DIV",{id:!0,style:!0,class:!0}),P(t).forEach(_),this.h()},h(){T(e,"type","button"),e.value="Refresh",T(t,"id","map"),x(t,"height","900px"),x(t,"width","100%"),T(t,"class","svelte-116milu")},m(o,c){U(o,e,c),U(o,n,c),U(o,t,c),l||(r=q(e,"click",i[0]),l=!0)},p:C,i:C,o:C,d(o){o&&_(e),o&&_(n),o&&_(t),l=!1,r()}}}function ye(i,e,n){let t=[],l=[],r=null,o=null,c=null,a=null,u=null,s=null,y=null,d=[];async function p(){console.log("refreshBusData"),v(),console.log("RM"),$(),console.log("Loc"),b(),console.log("LocS"),g(),console.log("User Loc")}async function f(){for(let h=0;h<l.length;h++)r.removeLayer(l[h]);l=[],$(),g()}function b(){for(let h=0;h<t.length;h++){let A=t[h].deploc.trim().split("      ");L.marker([A[0].trim(),A[1].trim()],{icon:c}).addTo(r).bindPopup("Start "+t[h].depname),A=t[h].arrloc.trim().split("      "),L.marker([A[0].trim(),A[1].trim()],{icon:o}).addTo(r).bindPopup("End "+t[h].arrname)}}async function v(){for(let h=0;h<t.length;h++){let A=await fetch(y+"/route/"+t[h].rtname),{data:B}=await A.json();J(B,h)}}function J(h,A){var B=new Array("blue","green","yellow","orange","pink","purple","black");for(let V=0;V<h.length;V++){var R=B[A];L.polyline(h[V]).addTo(r).setStyle({color:R})}}async function $(){for(let h=0;h<t.length;h++){let A=await fetch(y+"/data/"+t[h].rtname),{data:B}=await A.json();m(B,t[h].rtname,t[h].bound)}}function m(h,A,B){for(let R=0;R<h.length-1;R++){let V=parseFloat(h[R].lat),Z=parseFloat(h[R].lon);B.trim().toUpperCase()=="UNKNOWN"?l.push(L.marker([V,Z],{icon:s}).addTo(r).bindPopup("A "+A+" bus with "+h[R].id+" direction "+h[R].bound+`
. inbound or outbound could not be determined from google maps`)):h[R].bound.trim().toUpperCase()==B.trim().toUpperCase()&&l.push(L.marker([V,Z],{icon:u}).addTo(r).bindPopup("A "+A+" bus with "+h[R].id))}}function g(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(h=>{d=[h.coords.latitude,h.coords.longitude],w()})}function w(){l.push(L.marker([d[0],d[1]],{icon:a}).addTo(r).bindPopup("Your Location").openPopup())}function z(h){console.log("load map"),y=h.host,t=h.r,r=L.map("map").setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(r),a=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/location-dot.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),o=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-arrival.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),c=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-departure.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),u=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/43432/tick.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),s=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/510152/question.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),p()}return[f,p,z]}class ke extends H{constructor(e){super(),O(this,e,ye,we,G,{refreshBusData:1,refreshLocationData:0,load:2})}get refreshBusData(){return this.$$.ctx[1]}get refreshLocationData(){return this.$$.ctx[0]}get load(){return this.$$.ctx[2]}}function te(i,e,n){const t=i.slice();return t[7]=e[n],t}function oe(i,e,n){const t=i.slice();return t[10]=e[n],t}function ne(i){let e,n;return{c(){e=S("p"),n=j("Loading....")},l(t){e=I(t,"P",{});var l=P(e);n=N(l,"Loading...."),l.forEach(_)},m(t,l){U(t,e,l),k(e,n)},d(t){t&&_(e)}}}function le(i){let e,n;return e=new be({props:{bus:i[10]}}),{c(){he(e.$$.fragment)},l(t){de(e.$$.fragment,t)},m(t,l){me(e,t,l),n=!0},p(t,l){const r={};l&1&&(r.bus=t[10]),e.$set(r)},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){F(e.$$.fragment,t),n=!1},d(t){ge(e,t)}}}function se(i){let e,n,t,l,r,o,c,a,u=i[7].r,s=[];for(let d=0;d<u.length;d+=1)s[d]=le(oe(i,u,d));const y=d=>F(s[d],1,1,()=>{s[d]=null});return{c(){e=S("div"),n=S("p"),t=j("Route:"),l=D();for(let d=0;d<s.length;d+=1)s[d].c();r=D(),this.h()},l(d){e=I(d,"DIV",{class:!0});var p=P(e);n=I(p,"P",{class:!0});var f=P(n);t=N(f,"Route:"),f.forEach(_),l=E(p);for(let b=0;b<s.length;b+=1)s[b].l(p);r=E(p),p.forEach(_),this.h()},h(){T(n,"class","svelte-ppqq2x"),T(e,"class","svelte-ppqq2x")},m(d,p){U(d,e,p),k(e,n),k(n,t),k(e,l);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(e,null);k(e,r),o=!0,c||(a=[q(e,"click",function(){pe(i[2](i[7]))&&i[2](i[7]).apply(this,arguments)}),q(e,"keypress",{})],c=!0)},p(d,p){if(i=d,p&1){u=i[7].r;let f;for(f=0;f<u.length;f+=1){const b=oe(i,u,f);s[f]?(s[f].p(b,p),M(s[f],1)):(s[f]=le(b),s[f].c(),M(s[f],1),s[f].m(e,r))}for(W(),f=u.length;f<s.length;f+=1)y(f);Y()}},i(d){if(!o){for(let p=0;p<u.length;p+=1)M(s[p]);o=!0}},o(d){s=s.filter(Boolean);for(let p=0;p<s.length;p+=1)F(s[p]);o=!1},d(d){d&&_(e),X(s,d),c=!1,K(a)}}}function Le(i){let e,n,t,l=i[1]&&ne(),r=i[0],o=[];for(let a=0;a<r.length;a+=1)o[a]=se(te(i,r,a));const c=a=>F(o[a],1,1,()=>{o[a]=null});return{c(){l&&l.c(),e=D(),n=S("div");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){l&&l.l(a),e=E(a),n=I(a,"DIV",{class:!0});var u=P(n);for(let s=0;s<o.length;s+=1)o[s].l(u);u.forEach(_),this.h()},h(){T(n,"class","svelte-ppqq2x")},m(a,u){l&&l.m(a,u),U(a,e,u),U(a,n,u);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(n,null);t=!0},p(a,[u]){if(a[1]?l||(l=ne(),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),u&5){r=a[0];let s;for(s=0;s<r.length;s+=1){const y=te(a,r,s);o[s]?(o[s].p(y,u),M(o[s],1)):(o[s]=se(y),o[s].c(),M(o[s],1),o[s].m(n,null))}for(W(),s=r.length;s<o.length;s+=1)c(s);Y()}},i(a){if(!t){for(let u=0;u<r.length;u+=1)M(o[u]);t=!0}},o(a){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)F(o[u]);t=!1},d(a){l&&l.d(a),a&&_(e),a&&_(n),X(o,a)}}}function $e(i,e,n){let t=[],l=[],r="",o="",c=!1;async function a(s){console.log("Start Load"),o=s.host,l=s.location,r=s.destination,n(1,c=!0);let y=await fetch(o+"/dirs/?home="+l[0]+","+l[1]+"&dest="+r),{data:d}=await y.json();n(1,c=!1),n(0,t=d)}async function u(s){console.log("here");var y=new ke({target:document.querySelector("#Map")});console.log("here2"),y.load({host:o,r:s.r}),console.log("here3"),n(0,t=[s])}return[t,c,u,a]}class Se extends H{constructor(e){super(),O(this,e,$e,Le,G,{load:3})}get load(){return this.$$.ctx[3]}}function Ie(i){let e,n=i[0].name+"",t;return{c(){e=S("p"),t=j(n),this.h()},l(l){e=I(l,"P",{class:!0});var r=P(e);t=N(r,n),r.forEach(_),this.h()},h(){T(e,"class","svelte-sx44t9")},m(l,r){U(l,e,r),k(e,t)},p(l,[r]){r&1&&n!==(n=l[0].name+"")&&Q(t,n)},i:C,o:C,d(l){l&&_(e)}}}function Ue(i,e,n){let{destination:t}=e;return i.$$set=l=>{"destination"in l&&n(0,t=l.destination)},[t]}class Ae extends H{constructor(e){super(),O(this,e,Ue,Ie,G,{destination:0})}}function ie(i,e,n){const t=i.slice();return t[4]=e[n],t}function re(i){let e,n,t,l,r;return{c(){e=S("input"),n=D(),t=S("input"),this.h()},l(o){e=I(o,"INPUT",{type:!0}),n=E(o),t=I(o,"INPUT",{type:!0}),this.h()},h(){T(e,"type","text"),T(t,"type","button"),t.value="Search"},m(o,c){U(o,e,c),ee(e,i[2]),U(o,n,c),U(o,t,c),l||(r=[q(e,"input",i[9]),q(e,"keypress",i[8]),q(t,"click",i[6])],l=!0)},p(o,c){c&4&&e.value!==o[2]&&ee(e,o[2])},d(o){o&&_(e),o&&_(n),o&&_(t),l=!1,K(r)}}}function ae(i){let e,n;return{c(){e=S("p"),n=j("Loading...")},l(t){e=I(t,"P",{});var l=P(e);n=N(l,"Loading..."),l.forEach(_)},m(t,l){U(t,e,l),k(e,n)},d(t){t&&_(e)}}}function ce(i){let e,n,t,l,r;return n=new Ae({props:{destination:i[4]}}),{c(){e=S("div"),he(n.$$.fragment)},l(o){e=I(o,"DIV",{});var c=P(e);de(n.$$.fragment,c),c.forEach(_)},m(o,c){U(o,e,c),me(n,e,null),t=!0,l||(r=[q(e,"click",function(){pe(i[5](i[4]))&&i[5](i[4]).apply(this,arguments)}),q(e,"keypress",{})],l=!0)},p(o,c){i=o;const a={};c&2&&(a.destination=i[4]),n.$set(a)},i(o){t||(M(n.$$.fragment,o),t=!0)},o(o){F(n.$$.fragment,o),t=!1},d(o){o&&_(e),ge(n),l=!1,K(r)}}}function ue(i){let e,n,t,l,r;return{c(){e=S("input"),n=D(),t=S("input"),this.h()},l(o){e=I(o,"INPUT",{type:!0}),n=E(o),t=I(o,"INPUT",{type:!0}),this.h()},h(){T(e,"type","button"),e.value="Change Location",T(t,"type","button"),t.value="Reload Routes"},m(o,c){U(o,e,c),U(o,n,c),U(o,t,c),l||(r=[q(e,"click",Te),q(t,"click",i[7])],l=!0)},p:C,d(o){o&&_(e),o&&_(n),o&&_(t),l=!1,K(r)}}}function Pe(i){let e,n,t,l,r,o,c,a,u,s,y,d,p=i[0]==0&&re(i),f=i[3]&&ae(),b=i[1],v=[];for(let m=0;m<b.length;m+=1)v[m]=ce(ie(i,b,m));const J=m=>F(v[m],1,1,()=>{v[m]=null});let $=i[0]==1&&ue(i);return{c(){e=S("main"),n=S("h1"),t=j("Open Shef Bus"),l=D(),p&&p.c(),r=D(),f&&f.c(),o=D();for(let m=0;m<v.length;m+=1)v[m].c();c=D(),$&&$.c(),a=D(),u=S("div"),s=D(),y=S("div"),this.h()},l(m){e=I(m,"MAIN",{});var g=P(e);n=I(g,"H1",{});var w=P(n);t=N(w,"Open Shef Bus"),w.forEach(_),l=E(g),p&&p.l(g),r=E(g),f&&f.l(g),o=E(g);for(let z=0;z<v.length;z+=1)v[z].l(g);c=E(g),$&&$.l(g),a=E(g),u=I(g,"DIV",{id:!0}),P(u).forEach(_),s=E(g),y=I(g,"DIV",{id:!0}),P(y).forEach(_),g.forEach(_),this.h()},h(){T(u,"id","Rts"),T(y,"id","Map")},m(m,g){U(m,e,g),k(e,n),k(n,t),k(e,l),p&&p.m(e,null),k(e,r),f&&f.m(e,null),k(e,o);for(let w=0;w<v.length;w+=1)v[w]&&v[w].m(e,null);k(e,c),$&&$.m(e,null),k(e,a),k(e,u),k(e,s),k(e,y),d=!0},p(m,[g]){if(m[0]==0?p?p.p(m,g):(p=re(m),p.c(),p.m(e,r)):p&&(p.d(1),p=null),m[3]?f||(f=ae(),f.c(),f.m(e,o)):f&&(f.d(1),f=null),g&34){b=m[1];let w;for(w=0;w<b.length;w+=1){const z=ie(m,b,w);v[w]?(v[w].p(z,g),M(v[w],1)):(v[w]=ce(z),v[w].c(),M(v[w],1),v[w].m(e,c))}for(W(),w=b.length;w<v.length;w+=1)J(w);Y()}m[0]==1?$?$.p(m,g):($=ue(m),$.c(),$.m(e,a)):$&&($.d(1),$=null)},i(m){if(!d){for(let g=0;g<b.length;g+=1)M(v[g]);d=!0}},o(m){v=v.filter(Boolean);for(let g=0;g<v.length;g+=1)F(v[g]);d=!1},d(m){m&&_(e),p&&p.d(),f&&f.d(),X(v,m),$&&$.d()}}}let fe="https://deploy.thankfulsmoke-89b0f183.northeurope.azurecontainerapps.io";function Te(){document.location.reload()}function De(i,e,n){let t=0,l=[],r=[],o="",c="",a=!1;function u(){navigator.geolocation?navigator.geolocation.getCurrentPosition(b=>{r=[b.coords.latitude,b.coords.longitude];var v=new Se({target:document.querySelector("#Rts")});v.load({host:fe,location:r,destination:o}),n(0,t=1)}):alert("Geolocation is not supported by this browser.")}function s(b){n(4,o=b.id),console.log(b.id),n(1,l=[b]),u()}async function y(){n(3,a=!0);let b=await fetch(fe+"/search/?dest="+c),{data:v}=await b.json();n(3,a=!1),n(1,l=v)}function d(){document.querySelector("#Rts").innerHTML="",console.log("cleared"),u(),document.querySelector("#Map").innerHTML=""}const p=b=>{b.charCode===13&&y()};function f(){c=this.value,n(2,c)}return[t,l,c,a,o,s,y,d,p,f]}class Me extends H{constructor(e){super(),O(this,e,De,Pe,G,{})}}export{Me as default};
