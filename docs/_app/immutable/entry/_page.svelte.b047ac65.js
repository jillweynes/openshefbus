import{S as G,i as O,s as J,k as $,q as R,l as I,m as E,r as q,h as m,n as P,b as S,G as k,u as K,H as F,a as D,c as z,p as ee,J as B,g as M,v as W,f as X,d as C,K as Z,L as pe,M as Q,y as de,z as me,A as ge,B as _e,N as te}from"../chunks/index.855b6ba5.js";function be(i){let e,o,t=i[0].rtname+"",s,r,n=i[0].depname+"",c;return{c(){e=$("div"),o=$("p"),s=R(t),r=R(" from "),c=R(n),this.h()},l(a){e=I(a,"DIV",{class:!0});var u=E(e);o=I(u,"P",{});var l=E(o);s=q(l,t),r=q(l," from "),c=q(l,n),l.forEach(m),u.forEach(m),this.h()},h(){P(e,"class","svelte-fjfd5m")},m(a,u){S(a,e,u),k(e,o),k(o,s),k(o,r),k(o,c)},p(a,[u]){u&1&&t!==(t=a[0].rtname+"")&&K(s,t),u&1&&n!==(n=a[0].depname+"")&&K(c,n)},i:F,o:F,d(a){a&&m(e)}}}function ye(i,e,o){let{bus:t}=e;return i.$$set=s=>{"bus"in s&&o(0,t=s.bus)},[t]}class Le extends G{constructor(e){super(),O(this,e,ye,be,J,{bus:0})}}function ke(i){let e,o,t,s,r,n,c,a,u;return{c(){e=$("h1"),o=R("Get busses towards "),t=R(i[1]),s=D(),r=$("input"),n=D(),c=$("div"),this.h()},l(l){e=I(l,"H1",{});var g=E(e);o=q(g,"Get busses towards "),t=q(g,i[1]),g.forEach(m),s=z(l),r=I(l,"INPUT",{type:!0}),n=z(l),c=I(l,"DIV",{id:!0,style:!0,class:!0}),E(c).forEach(m),this.h()},h(){P(r,"type","button"),r.value="Refresh",P(c,"id","map"),ee(c,"height","900px"),ee(c,"width","100%"),P(c,"class","svelte-116milu")},m(l,g){S(l,e,g),k(e,o),k(e,t),S(l,s,g),S(l,r,g),S(l,n,g),S(l,c,g),a||(u=B(r,"click",i[0]),a=!0)},p(l,[g]){g&2&&K(t,l[1])},i:F,o:F,d(l){l&&m(e),l&&m(s),l&&m(r),l&&m(n),l&&m(c),a=!1,u()}}}function Se(i,e,o){let t=[],s=[],r=null,n=null,c=null,a=null,u=null,l=null,g=null,d=null,p=[],f="";async function b(){console.log("refreshBusData"),A(),console.log("RM"),v(),console.log("Loc"),Y(),console.log("LocS"),x(),console.log("User Loc")}async function w(){for(let h=0;h<s.length;h++)r.removeLayer(s[h]);s=[],v(),x()}function Y(){for(let h=0;h<t.length;h++){let U=t[h].deploc.trim().split("      ");L.marker([U[0].trim(),U[1].trim()],{icon:c}).addTo(r).bindPopup("Start "+t[h].depname),U=t[h].arrloc.trim().split("      "),L.marker([U[0].trim(),U[1].trim()],{icon:n}).addTo(r).bindPopup("End "+t[h].arrname)}}async function A(){for(let h=0;h<t.length;h++){let U=await fetch(d+"/route/"+t[h].rtname),{data:T}=await U.json();_(T,h),f!=""&&o(1,f+=", "),o(1,f+=t[h].header)}}function _(h,U){var T=new Array("blue","green","yellow","orange","pink","purple","black");for(let V=0;V<h.length;V++){var N=T[U];L.polyline(h[V]).addTo(r).setStyle({color:N})}}async function v(){for(let h=0;h<t.length;h++){let U=await fetch(d+"/data/"+t[h].rtname),{data:T}=await U.json();y(T,t[h].rtname)}}function y(h,U){for(let T=0;T<h.length-1;T++){let N=parseFloat(h[T].lat),V=parseFloat(h[T].lon),H=g;h[T].bound.toLowerCase()=="inbound"?H=u:h[T].bound.toLowerCase()=="outbound"&&(H=l),s.push(L.marker([N,V],{icon:H}).addTo(r).bindPopup("A "+U+" bus with "+h[T].id+" bound "+h[T].bound+" ("+h[T].dest+")"))}}async function j(h,U){let T=h.getContent();h.setContent(T+". Time away: Loading...");let N=t[0].deploc.trim().split("      ");var H=await(await fetch(d+"/time/"+U[0]+","+U[1]+"/"+N[0].trim()+","+N[1].trim())).text();h.setContent(T+". Time away: "+H)}function x(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(h=>{p=[h.coords.latitude,h.coords.longitude],ve()})}function ve(){s.push(L.marker([p[0],p[1]],{icon:a}).addTo(r).bindPopup("Your Location").openPopup())}function we(h){console.log("load map"),d=h.host,t=h.r,r=L.map("map").setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(r),a=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/location-dot.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),n=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-arrival.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),c=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-departure.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),u=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/522689/up-circle.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[20,20]}),l=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/522522/down-circle.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[20,20]}),g=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/510152/question.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),b()}return[w,f,b,j,we]}class $e extends G{constructor(e){super(),O(this,e,Se,ke,J,{refreshBusData:2,refreshLocationData:0,addSpecificEndTime:3,load:4})}get refreshBusData(){return this.$$.ctx[2]}get refreshLocationData(){return this.$$.ctx[0]}get addSpecificEndTime(){return this.$$.ctx[3]}get load(){return this.$$.ctx[4]}}function oe(i,e,o){const t=i.slice();return t[7]=e[o],t}function ne(i,e,o){const t=i.slice();return t[10]=e[o],t}function le(i){let e,o;return{c(){e=$("p"),o=R("Loading....")},l(t){e=I(t,"P",{});var s=E(e);o=q(s,"Loading...."),s.forEach(m)},m(t,s){S(t,e,s),k(e,o)},d(t){t&&m(e)}}}function se(i){let e,o;return e=new Le({props:{bus:i[10]}}),{c(){de(e.$$.fragment)},l(t){me(e.$$.fragment,t)},m(t,s){ge(e,t,s),o=!0},p(t,s){const r={};s&1&&(r.bus=t[10]),e.$set(r)},i(t){o||(M(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){_e(e,t)}}}function ie(i){let e,o,t,s,r,n,c,a,u=i[7].r,l=[];for(let d=0;d<u.length;d+=1)l[d]=se(ne(i,u,d));const g=d=>C(l[d],1,1,()=>{l[d]=null});return{c(){e=$("div"),o=$("p"),t=R("Route:"),s=D();for(let d=0;d<l.length;d+=1)l[d].c();r=D(),this.h()},l(d){e=I(d,"DIV",{class:!0});var p=E(e);o=I(p,"P",{class:!0});var f=E(o);t=q(f,"Route:"),f.forEach(m),s=z(p);for(let b=0;b<l.length;b+=1)l[b].l(p);r=z(p),p.forEach(m),this.h()},h(){P(o,"class","svelte-ppqq2x"),P(e,"class","svelte-ppqq2x")},m(d,p){S(d,e,p),k(e,o),k(o,t),k(e,s);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);k(e,r),n=!0,c||(a=[B(e,"click",function(){pe(i[2](i[7]))&&i[2](i[7]).apply(this,arguments)}),B(e,"keypress",{})],c=!0)},p(d,p){if(i=d,p&1){u=i[7].r;let f;for(f=0;f<u.length;f+=1){const b=ne(i,u,f);l[f]?(l[f].p(b,p),M(l[f],1)):(l[f]=se(b),l[f].c(),M(l[f],1),l[f].m(e,r))}for(W(),f=u.length;f<l.length;f+=1)g(f);X()}},i(d){if(!n){for(let p=0;p<u.length;p+=1)M(l[p]);n=!0}},o(d){l=l.filter(Boolean);for(let p=0;p<l.length;p+=1)C(l[p]);n=!1},d(d){d&&m(e),Z(l,d),c=!1,Q(a)}}}function Ie(i){let e,o,t,s=i[1]&&le(),r=i[0],n=[];for(let a=0;a<r.length;a+=1)n[a]=ie(oe(i,r,a));const c=a=>C(n[a],1,1,()=>{n[a]=null});return{c(){s&&s.c(),e=D(),o=$("div");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){s&&s.l(a),e=z(a),o=I(a,"DIV",{class:!0});var u=E(o);for(let l=0;l<n.length;l+=1)n[l].l(u);u.forEach(m),this.h()},h(){P(o,"class","svelte-ppqq2x")},m(a,u){s&&s.m(a,u),S(a,e,u),S(a,o,u);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(o,null);t=!0},p(a,[u]){if(a[1]?s||(s=le(),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null),u&5){r=a[0];let l;for(l=0;l<r.length;l+=1){const g=oe(a,r,l);n[l]?(n[l].p(g,u),M(n[l],1)):(n[l]=ie(g),n[l].c(),M(n[l],1),n[l].m(o,null))}for(W(),l=r.length;l<n.length;l+=1)c(l);X()}},i(a){if(!t){for(let u=0;u<r.length;u+=1)M(n[u]);t=!0}},o(a){n=n.filter(Boolean);for(let u=0;u<n.length;u+=1)C(n[u]);t=!1},d(a){s&&s.d(a),a&&m(e),a&&m(o),Z(n,a)}}}function Ae(i,e,o){let t=[],s=[],r="",n="",c=!1;async function a(l){console.log("Start Load"),n=l.host,s=l.location,r=l.destination,o(1,c=!0);let g=await fetch(n+"/dirs/?home="+s[0]+","+s[1]+"&dest="+r),{data:d}=await g.json();o(1,c=!1),o(0,t=d)}async function u(l){console.log("here");var g=new $e({target:document.querySelector("#Map")});console.log("here2"),g.load({host:n,r:l.r}),console.log("here3"),o(0,t=[l])}return[t,c,u,a]}class Te extends G{constructor(e){super(),O(this,e,Ae,Ie,J,{load:3})}get load(){return this.$$.ctx[3]}}function Ue(i){let e,o=i[0].name+"",t;return{c(){e=$("p"),t=R(o),this.h()},l(s){e=I(s,"P",{class:!0});var r=E(e);t=q(r,o),r.forEach(m),this.h()},h(){P(e,"class","svelte-sx44t9")},m(s,r){S(s,e,r),k(e,t)},p(s,[r]){r&1&&o!==(o=s[0].name+"")&&K(t,o)},i:F,o:F,d(s){s&&m(e)}}}function Ee(i,e,o){let{destination:t}=e;return i.$$set=s=>{"destination"in s&&o(0,t=s.destination)},[t]}class Pe extends G{constructor(e){super(),O(this,e,Ee,Ue,J,{destination:0})}}function re(i,e,o){const t=i.slice();return t[4]=e[o],t}function ae(i){let e,o,t,s,r;return{c(){e=$("input"),o=D(),t=$("input"),this.h()},l(n){e=I(n,"INPUT",{type:!0}),o=z(n),t=I(n,"INPUT",{type:!0}),this.h()},h(){P(e,"type","text"),P(t,"type","button"),t.value="Search"},m(n,c){S(n,e,c),te(e,i[2]),S(n,o,c),S(n,t,c),s||(r=[B(e,"input",i[9]),B(e,"keypress",i[8]),B(t,"click",i[6])],s=!0)},p(n,c){c&4&&e.value!==n[2]&&te(e,n[2])},d(n){n&&m(e),n&&m(o),n&&m(t),s=!1,Q(r)}}}function ce(i){let e,o;return{c(){e=$("p"),o=R("Loading...")},l(t){e=I(t,"P",{});var s=E(e);o=q(s,"Loading..."),s.forEach(m)},m(t,s){S(t,e,s),k(e,o)},d(t){t&&m(e)}}}function ue(i){let e,o,t,s,r;return o=new Pe({props:{destination:i[4]}}),{c(){e=$("div"),de(o.$$.fragment)},l(n){e=I(n,"DIV",{});var c=E(e);me(o.$$.fragment,c),c.forEach(m)},m(n,c){S(n,e,c),ge(o,e,null),t=!0,s||(r=[B(e,"click",function(){pe(i[5](i[4]))&&i[5](i[4]).apply(this,arguments)}),B(e,"keypress",{})],s=!0)},p(n,c){i=n;const a={};c&2&&(a.destination=i[4]),o.$set(a)},i(n){t||(M(o.$$.fragment,n),t=!0)},o(n){C(o.$$.fragment,n),t=!1},d(n){n&&m(e),_e(o),s=!1,Q(r)}}}function fe(i){let e,o,t,s,r;return{c(){e=$("input"),o=D(),t=$("input"),this.h()},l(n){e=I(n,"INPUT",{type:!0}),o=z(n),t=I(n,"INPUT",{type:!0}),this.h()},h(){P(e,"type","button"),e.value="Change Location",P(t,"type","button"),t.value="Reload Routes"},m(n,c){S(n,e,c),S(n,o,c),S(n,t,c),s||(r=[B(e,"click",ze),B(t,"click",i[7])],s=!0)},p:F,d(n){n&&m(e),n&&m(o),n&&m(t),s=!1,Q(r)}}}function De(i){let e,o,t,s,r,n,c,a,u,l,g,d,p=i[0]==0&&ae(i),f=i[3]&&ce(),b=i[1],w=[];for(let _=0;_<b.length;_+=1)w[_]=ue(re(i,b,_));const Y=_=>C(w[_],1,1,()=>{w[_]=null});let A=i[0]==1&&fe(i);return{c(){e=$("main"),o=$("h1"),t=R("Open Shef Bus"),s=D(),p&&p.c(),r=D(),f&&f.c(),n=D();for(let _=0;_<w.length;_+=1)w[_].c();c=D(),A&&A.c(),a=D(),u=$("div"),l=D(),g=$("div"),this.h()},l(_){e=I(_,"MAIN",{});var v=E(e);o=I(v,"H1",{});var y=E(o);t=q(y,"Open Shef Bus"),y.forEach(m),s=z(v),p&&p.l(v),r=z(v),f&&f.l(v),n=z(v);for(let j=0;j<w.length;j+=1)w[j].l(v);c=z(v),A&&A.l(v),a=z(v),u=I(v,"DIV",{id:!0}),E(u).forEach(m),l=z(v),g=I(v,"DIV",{id:!0}),E(g).forEach(m),v.forEach(m),this.h()},h(){P(u,"id","Rts"),P(g,"id","Map")},m(_,v){S(_,e,v),k(e,o),k(o,t),k(e,s),p&&p.m(e,null),k(e,r),f&&f.m(e,null),k(e,n);for(let y=0;y<w.length;y+=1)w[y]&&w[y].m(e,null);k(e,c),A&&A.m(e,null),k(e,a),k(e,u),k(e,l),k(e,g),d=!0},p(_,[v]){if(_[0]==0?p?p.p(_,v):(p=ae(_),p.c(),p.m(e,r)):p&&(p.d(1),p=null),_[3]?f||(f=ce(),f.c(),f.m(e,n)):f&&(f.d(1),f=null),v&34){b=_[1];let y;for(y=0;y<b.length;y+=1){const j=re(_,b,y);w[y]?(w[y].p(j,v),M(w[y],1)):(w[y]=ue(j),w[y].c(),M(w[y],1),w[y].m(e,c))}for(W(),y=b.length;y<w.length;y+=1)Y(y);X()}_[0]==1?A?A.p(_,v):(A=fe(_),A.c(),A.m(e,a)):A&&(A.d(1),A=null)},i(_){if(!d){for(let v=0;v<b.length;v+=1)M(w[v]);d=!0}},o(_){w=w.filter(Boolean);for(let v=0;v<w.length;v+=1)C(w[v]);d=!1},d(_){_&&m(e),p&&p.d(),f&&f.d(),Z(w,_),A&&A.d()}}}let he="https://shefbus.thankfulsmoke-89b0f183.northeurope.azurecontainerapps.io/";function ze(){document.location.reload()}function Me(i,e,o){let t=0,s=[],r=[],n="",c="",a=!1;function u(){navigator.geolocation?navigator.geolocation.getCurrentPosition(b=>{r=[b.coords.latitude,b.coords.longitude];var w=new Te({target:document.querySelector("#Rts")});w.load({host:he,location:r,destination:n}),o(0,t=1)}):alert("Geolocation is not supported by this browser.")}function l(b){o(4,n=b.id),console.log(b.id),o(1,s=[b]),u()}async function g(){o(3,a=!0);let b=await fetch(he+"/search/?dest="+c),{data:w}=await b.json();o(3,a=!1),o(1,s=w)}function d(){document.querySelector("#Rts").innerHTML="",console.log("cleared"),u(),document.querySelector("#Map").innerHTML=""}const p=b=>{b.charCode===13&&g()};function f(){c=this.value,o(2,c)}return[t,s,c,a,n,l,g,d,p,f]}class qe extends G{constructor(e){super(),O(this,e,Me,De,J,{})}}export{qe as default};
