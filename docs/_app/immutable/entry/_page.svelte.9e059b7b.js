import{S as O,i as G,s as K,k as T,q as C,l as P,m as A,r as N,h as g,n as E,b as I,G as k,u as Q,H as F,a as M,c as R,p as Z,J as z,g as q,v as W,f as Y,d as V,K as X,L as pe,M as x,y as he,z as de,A as me,B as ge,N as ee}from"../chunks/index.855b6ba5.js";function be(i){let e,n,t=i[0].rtname+"",l,r,o=i[0].depname+"",c;return{c(){e=T("div"),n=T("p"),l=C(t),r=C(" from "),c=C(o),this.h()},l(a){e=P(a,"DIV",{class:!0});var u=A(e);n=P(u,"P",{});var s=A(n);l=N(s,t),r=N(s," from "),c=N(s,o),s.forEach(g),u.forEach(g),this.h()},h(){E(e,"class","svelte-fjfd5m")},m(a,u){I(a,e,u),k(e,n),k(n,l),k(n,r),k(n,c)},p(a,[u]){u&1&&t!==(t=a[0].rtname+"")&&Q(l,t),u&1&&o!==(o=a[0].depname+"")&&Q(c,o)},i:F,o:F,d(a){a&&g(e)}}}function ye(i,e,n){let{bus:t}=e;return i.$$set=l=>{"bus"in l&&n(0,t=l.bus)},[t]}class ke extends O{constructor(e){super(),G(this,e,ye,be,K,{bus:0})}}function Le(i){let e,n,t,l,r;return{c(){e=T("input"),n=M(),t=T("div"),this.h()},l(o){e=P(o,"INPUT",{type:!0}),n=R(o),t=P(o,"DIV",{id:!0,style:!0,class:!0}),A(t).forEach(g),this.h()},h(){E(e,"type","button"),e.value="Refresh",E(t,"id","map"),Z(t,"height","900px"),Z(t,"width","100%"),E(t,"class","svelte-116milu")},m(o,c){I(o,e,c),I(o,n,c),I(o,t,c),l||(r=z(e,"click",i[0]),l=!0)},p:F,i:F,o:F,d(o){o&&g(e),o&&g(n),o&&g(t),l=!1,r()}}}function $e(i,e,n){let t=[],l=[],r=null,o=null,c=null,a=null,u=null,s=null,y=null,d=[];async function h(){console.log("refreshBusData"),v(),console.log("RM"),S(),console.log("Loc"),w(),console.log("LocS"),B(),console.log("User Loc")}async function p(){for(let f=0;f<l.length;f++)r.removeLayer(l[f]);l=[],S(),B()}function w(){for(let f=0;f<t.length;f++){let $=t[f].deploc.trim().split("      ");L.marker([$[0].trim(),$[1].trim()],{icon:c}).addTo(r).bindPopup("Start "+t[f].depname),$=t[f].arrloc.trim().split("      "),L.marker([$[0].trim(),$[1].trim()],{icon:o}).addTo(r).bindPopup("End "+t[f].arrname)}}async function v(){for(let f=0;f<t.length;f++){let $=await fetch(y+"/route/"+t[f].rtname),{data:D}=await $.json();J(D,f)}}function J(f,$){var D=new Array("blue","green","yellow","orange","pink","purple","black");for(let j=0;j<f.length;j++){var U=D[$];L.polyline(f[j]).addTo(r).setStyle({color:U})}}async function S(){for(let f=0;f<t.length;f++){let $=await fetch(y+"/data/"+t[f].rtname),{data:D}=await $.json();m(D,t[f].rtname,t[f].bound)}}function m(f,$,D){for(let U=0;U<f.length-1;U++){let j=parseFloat(f[U].lat),H=parseFloat(f[U].lon);D.trim().toUpperCase()=="UNKNOWN"?l.push(L.marker([j,H],{icon:s}).addTo(r).bindPopup("A "+$+" bus with "+f[U].id+" direction "+f[U].bound+`
. inbound or outbound could not be determined from google maps`)):f[U].bound.trim().toUpperCase()==D.trim().toUpperCase()&&l.push(L.marker([j,H],{icon:u}).addTo(r).bindPopup("A "+$+" bus with "+f[U].id).on("click",function(we){_(we,$,[j,H])}))}}function _(f,$,D){if($==t[0].rtname){var U=f.target.getPopup();b(U,D)}}async function b(f,$){let D=f.getContent();f.setContent(D+". Time away: Loading...");let U=t[0].deploc.trim().split("      ");var H=await(await fetch(y+"/time/"+$[0]+","+$[1]+"/"+U[0].trim()+","+U[1].trim())).text();f.setContent(D+". Time away: "+H)}function B(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(f=>{d=[f.coords.latitude,f.coords.longitude],_e()})}function _e(){l.push(L.marker([d[0],d[1]],{icon:a}).addTo(r).bindPopup("Your Location").openPopup())}function ve(f){console.log("load map"),y=f.host,t=f.r,r=L.map("map").setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(r),a=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/location-dot.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),o=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-arrival.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),c=new L.Icon({iconUrl:"https://raw.githubusercontent.com/FortAwesome/Font-Awesome/6.x/svgs/solid/plane-departure.svg",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),u=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/43432/tick.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),s=new L.Icon({iconUrl:"https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/bus.svg",shadowUrl:"https://www.svgrepo.com/show/510152/question.svg",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[10,10]}),h()}return[p,h,b,ve]}class Se extends O{constructor(e){super(),G(this,e,$e,Le,K,{refreshBusData:1,refreshLocationData:0,addSpecificEndTime:2,load:3})}get refreshBusData(){return this.$$.ctx[1]}get refreshLocationData(){return this.$$.ctx[0]}get addSpecificEndTime(){return this.$$.ctx[2]}get load(){return this.$$.ctx[3]}}function te(i,e,n){const t=i.slice();return t[7]=e[n],t}function oe(i,e,n){const t=i.slice();return t[10]=e[n],t}function ne(i){let e,n;return{c(){e=T("p"),n=C("Loading....")},l(t){e=P(t,"P",{});var l=A(e);n=N(l,"Loading...."),l.forEach(g)},m(t,l){I(t,e,l),k(e,n)},d(t){t&&g(e)}}}function le(i){let e,n;return e=new ke({props:{bus:i[10]}}),{c(){he(e.$$.fragment)},l(t){de(e.$$.fragment,t)},m(t,l){me(e,t,l),n=!0},p(t,l){const r={};l&1&&(r.bus=t[10]),e.$set(r)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){V(e.$$.fragment,t),n=!1},d(t){ge(e,t)}}}function se(i){let e,n,t,l,r,o,c,a,u=i[7].r,s=[];for(let d=0;d<u.length;d+=1)s[d]=le(oe(i,u,d));const y=d=>V(s[d],1,1,()=>{s[d]=null});return{c(){e=T("div"),n=T("p"),t=C("Route:"),l=M();for(let d=0;d<s.length;d+=1)s[d].c();r=M(),this.h()},l(d){e=P(d,"DIV",{class:!0});var h=A(e);n=P(h,"P",{class:!0});var p=A(n);t=N(p,"Route:"),p.forEach(g),l=R(h);for(let w=0;w<s.length;w+=1)s[w].l(h);r=R(h),h.forEach(g),this.h()},h(){E(n,"class","svelte-ppqq2x"),E(e,"class","svelte-ppqq2x")},m(d,h){I(d,e,h),k(e,n),k(n,t),k(e,l);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(e,null);k(e,r),o=!0,c||(a=[z(e,"click",function(){pe(i[2](i[7]))&&i[2](i[7]).apply(this,arguments)}),z(e,"keypress",{})],c=!0)},p(d,h){if(i=d,h&1){u=i[7].r;let p;for(p=0;p<u.length;p+=1){const w=oe(i,u,p);s[p]?(s[p].p(w,h),q(s[p],1)):(s[p]=le(w),s[p].c(),q(s[p],1),s[p].m(e,r))}for(W(),p=u.length;p<s.length;p+=1)y(p);Y()}},i(d){if(!o){for(let h=0;h<u.length;h+=1)q(s[h]);o=!0}},o(d){s=s.filter(Boolean);for(let h=0;h<s.length;h+=1)V(s[h]);o=!1},d(d){d&&g(e),X(s,d),c=!1,x(a)}}}function Te(i){let e,n,t,l=i[1]&&ne(),r=i[0],o=[];for(let a=0;a<r.length;a+=1)o[a]=se(te(i,r,a));const c=a=>V(o[a],1,1,()=>{o[a]=null});return{c(){l&&l.c(),e=M(),n=T("div");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){l&&l.l(a),e=R(a),n=P(a,"DIV",{class:!0});var u=A(n);for(let s=0;s<o.length;s+=1)o[s].l(u);u.forEach(g),this.h()},h(){E(n,"class","svelte-ppqq2x")},m(a,u){l&&l.m(a,u),I(a,e,u),I(a,n,u);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(n,null);t=!0},p(a,[u]){if(a[1]?l||(l=ne(),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null),u&5){r=a[0];let s;for(s=0;s<r.length;s+=1){const y=te(a,r,s);o[s]?(o[s].p(y,u),q(o[s],1)):(o[s]=se(y),o[s].c(),q(o[s],1),o[s].m(n,null))}for(W(),s=r.length;s<o.length;s+=1)c(s);Y()}},i(a){if(!t){for(let u=0;u<r.length;u+=1)q(o[u]);t=!0}},o(a){o=o.filter(Boolean);for(let u=0;u<o.length;u+=1)V(o[u]);t=!1},d(a){l&&l.d(a),a&&g(e),a&&g(n),X(o,a)}}}function Pe(i,e,n){let t=[],l=[],r="",o="",c=!1;async function a(s){console.log("Start Load"),o=s.host,l=s.location,r=s.destination,n(1,c=!0);let y=await fetch(o+"/dirs/?home="+l[0]+","+l[1]+"&dest="+r),{data:d}=await y.json();n(1,c=!1),n(0,t=d)}async function u(s){console.log("here");var y=new Se({target:document.querySelector("#Map")});console.log("here2"),y.load({host:o,r:s.r}),console.log("here3"),n(0,t=[s])}return[t,c,u,a]}class Ie extends O{constructor(e){super(),G(this,e,Pe,Te,K,{load:3})}get load(){return this.$$.ctx[3]}}function Ue(i){let e,n=i[0].name+"",t;return{c(){e=T("p"),t=C(n),this.h()},l(l){e=P(l,"P",{class:!0});var r=A(e);t=N(r,n),r.forEach(g),this.h()},h(){E(e,"class","svelte-sx44t9")},m(l,r){I(l,e,r),k(e,t)},p(l,[r]){r&1&&n!==(n=l[0].name+"")&&Q(t,n)},i:F,o:F,d(l){l&&g(e)}}}function Ae(i,e,n){let{destination:t}=e;return i.$$set=l=>{"destination"in l&&n(0,t=l.destination)},[t]}class Ee extends O{constructor(e){super(),G(this,e,Ae,Ue,K,{destination:0})}}function ie(i,e,n){const t=i.slice();return t[4]=e[n],t}function re(i){let e,n,t,l,r;return{c(){e=T("input"),n=M(),t=T("input"),this.h()},l(o){e=P(o,"INPUT",{type:!0}),n=R(o),t=P(o,"INPUT",{type:!0}),this.h()},h(){E(e,"type","text"),E(t,"type","button"),t.value="Search"},m(o,c){I(o,e,c),ee(e,i[2]),I(o,n,c),I(o,t,c),l||(r=[z(e,"input",i[9]),z(e,"keypress",i[8]),z(t,"click",i[6])],l=!0)},p(o,c){c&4&&e.value!==o[2]&&ee(e,o[2])},d(o){o&&g(e),o&&g(n),o&&g(t),l=!1,x(r)}}}function ae(i){let e,n;return{c(){e=T("p"),n=C("Loading...")},l(t){e=P(t,"P",{});var l=A(e);n=N(l,"Loading..."),l.forEach(g)},m(t,l){I(t,e,l),k(e,n)},d(t){t&&g(e)}}}function ce(i){let e,n,t,l,r;return n=new Ee({props:{destination:i[4]}}),{c(){e=T("div"),he(n.$$.fragment)},l(o){e=P(o,"DIV",{});var c=A(e);de(n.$$.fragment,c),c.forEach(g)},m(o,c){I(o,e,c),me(n,e,null),t=!0,l||(r=[z(e,"click",function(){pe(i[5](i[4]))&&i[5](i[4]).apply(this,arguments)}),z(e,"keypress",{})],l=!0)},p(o,c){i=o;const a={};c&2&&(a.destination=i[4]),n.$set(a)},i(o){t||(q(n.$$.fragment,o),t=!0)},o(o){V(n.$$.fragment,o),t=!1},d(o){o&&g(e),ge(n),l=!1,x(r)}}}function ue(i){let e,n,t,l,r;return{c(){e=T("input"),n=M(),t=T("input"),this.h()},l(o){e=P(o,"INPUT",{type:!0}),n=R(o),t=P(o,"INPUT",{type:!0}),this.h()},h(){E(e,"type","button"),e.value="Change Location",E(t,"type","button"),t.value="Reload Routes"},m(o,c){I(o,e,c),I(o,n,c),I(o,t,c),l||(r=[z(e,"click",Me),z(t,"click",i[7])],l=!0)},p:F,d(o){o&&g(e),o&&g(n),o&&g(t),l=!1,x(r)}}}function De(i){let e,n,t,l,r,o,c,a,u,s,y,d,h=i[0]==0&&re(i),p=i[3]&&ae(),w=i[1],v=[];for(let m=0;m<w.length;m+=1)v[m]=ce(ie(i,w,m));const J=m=>V(v[m],1,1,()=>{v[m]=null});let S=i[0]==1&&ue(i);return{c(){e=T("main"),n=T("h1"),t=C("Open Shef Bus"),l=M(),h&&h.c(),r=M(),p&&p.c(),o=M();for(let m=0;m<v.length;m+=1)v[m].c();c=M(),S&&S.c(),a=M(),u=T("div"),s=M(),y=T("div"),this.h()},l(m){e=P(m,"MAIN",{});var _=A(e);n=P(_,"H1",{});var b=A(n);t=N(b,"Open Shef Bus"),b.forEach(g),l=R(_),h&&h.l(_),r=R(_),p&&p.l(_),o=R(_);for(let B=0;B<v.length;B+=1)v[B].l(_);c=R(_),S&&S.l(_),a=R(_),u=P(_,"DIV",{id:!0}),A(u).forEach(g),s=R(_),y=P(_,"DIV",{id:!0}),A(y).forEach(g),_.forEach(g),this.h()},h(){E(u,"id","Rts"),E(y,"id","Map")},m(m,_){I(m,e,_),k(e,n),k(n,t),k(e,l),h&&h.m(e,null),k(e,r),p&&p.m(e,null),k(e,o);for(let b=0;b<v.length;b+=1)v[b]&&v[b].m(e,null);k(e,c),S&&S.m(e,null),k(e,a),k(e,u),k(e,s),k(e,y),d=!0},p(m,[_]){if(m[0]==0?h?h.p(m,_):(h=re(m),h.c(),h.m(e,r)):h&&(h.d(1),h=null),m[3]?p||(p=ae(),p.c(),p.m(e,o)):p&&(p.d(1),p=null),_&34){w=m[1];let b;for(b=0;b<w.length;b+=1){const B=ie(m,w,b);v[b]?(v[b].p(B,_),q(v[b],1)):(v[b]=ce(B),v[b].c(),q(v[b],1),v[b].m(e,c))}for(W(),b=w.length;b<v.length;b+=1)J(b);Y()}m[0]==1?S?S.p(m,_):(S=ue(m),S.c(),S.m(e,a)):S&&(S.d(1),S=null)},i(m){if(!d){for(let _=0;_<w.length;_+=1)q(v[_]);d=!0}},o(m){v=v.filter(Boolean);for(let _=0;_<v.length;_+=1)V(v[_]);d=!1},d(m){m&&g(e),h&&h.d(),p&&p.d(),X(v,m),S&&S.d()}}}let fe="https://shefbus.thankfulsmoke-89b0f183.northeurope.azurecontainerapps.io/";function Me(){document.location.reload()}function Re(i,e,n){let t=0,l=[],r=[],o="",c="",a=!1;function u(){navigator.geolocation?navigator.geolocation.getCurrentPosition(w=>{r=[w.coords.latitude,w.coords.longitude];var v=new Ie({target:document.querySelector("#Rts")});v.load({host:fe,location:r,destination:o}),n(0,t=1)}):alert("Geolocation is not supported by this browser.")}function s(w){n(4,o=w.id),console.log(w.id),n(1,l=[w]),u()}async function y(){n(3,a=!0);let w=await fetch(fe+"/search/?dest="+c),{data:v}=await w.json();n(3,a=!1),n(1,l=v)}function d(){document.querySelector("#Rts").innerHTML="",console.log("cleared"),u(),document.querySelector("#Map").innerHTML=""}const h=w=>{w.charCode===13&&y()};function p(){c=this.value,n(2,c)}return[t,l,c,a,o,s,y,d,h,p]}class ze extends O{constructor(e){super(),G(this,e,Re,De,K,{})}}export{ze as default};
