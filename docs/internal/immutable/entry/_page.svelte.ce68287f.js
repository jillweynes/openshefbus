import{S as N,i as H,s as C,k,q as A,a as T,l as w,m as I,r as q,h as g,c as E,n as R,b as P,G as y,u as G,H as U,p as Y,J as j,e as Q,g as B,v as F,f as J,d as V,K,L as ie,M as O,y as re,z as se,A as ce,B as ue,N as W}from"../chunks/index.855b6ba5.js";function he(a){let e,l,t,n,s,o=a[0].rtname+"",i,f,d,h=a[0].depname+"",$;return{c(){e=k("div"),l=k("p"),t=A("Bus:"),n=T(),s=k("p"),i=A(o),f=T(),d=k("p"),$=A(h),this.h()},l(c){e=w(c,"DIV",{class:!0});var u=I(e);l=w(u,"P",{});var r=I(l);t=q(r,"Bus:"),r.forEach(g),n=E(u),s=w(u,"P",{});var S=I(s);i=q(S,o),S.forEach(g),f=E(u),d=w(u,"P",{});var b=I(d);$=q(b,h),b.forEach(g),u.forEach(g),this.h()},h(){R(e,"class","svelte-fjfd5m")},m(c,u){P(c,e,u),y(e,l),y(l,t),y(e,n),y(e,s),y(s,i),y(e,f),y(e,d),y(d,$)},p(c,[u]){u&1&&o!==(o=c[0].rtname+"")&&G(i,o),u&1&&h!==(h=c[0].depname+"")&&G($,h)},i:U,o:U,d(c){c&&g(e)}}}function pe(a,e,l){let{bus:t}=e;return a.$$set=n=>{"bus"in n&&l(0,t=n.bus)},[t]}class de extends N{constructor(e){super(),H(this,e,pe,he,C,{bus:0})}}function me(a){let e,l,t,n,s;return{c(){e=k("input"),l=T(),t=k("div"),this.h()},l(o){e=w(o,"INPUT",{type:!0}),l=E(o),t=w(o,"DIV",{id:!0,style:!0}),I(t).forEach(g),this.h()},h(){R(e,"type","button"),e.value="Refresh",R(t,"id","map"),Y(t,"height","900px"),Y(t,"width","100%")},m(o,i){P(o,e,i),P(o,l,i),P(o,t,i),n||(s=j(e,"click",a[0]),n=!0)},p:U,i:U,o:U,d(o){o&&g(e),o&&g(l),o&&g(t),n=!1,s()}}}function _e(a,e,l){let t=[],n=[],s=null,o=null,i=null,f=null,d=[];async function h(){console.log("refreshBusData"),u(),console.log("RM"),S(),console.log("Loc"),c(),console.log("LocS"),m(),console.log("User Loc")}async function $(){for(let p=0;p<n.length;p++)s.removeLayer(n[p]);n=[],S(),m()}function c(){for(let p=0;p<t.length;p++){let D=t[p].deploc.trim().split("      ");L.marker([D[0].trim(),D[1].trim()],{icon:o}).addTo(s).bindPopup("Start "+t[p].depname),D=t[p].arrloc.trim().split("      "),L.marker([D[0].trim(),D[1].trim()],{icon:o}).addTo(s).bindPopup("End "+t[p].arrname)}}async function u(){for(let p=0;p<t.length;p++){let D=await fetch(f+"/route/"+t[p].rtname),{data:M}=await D.json();r(M)}}function r(p){for(let z=0;z<p.length;z++){var D=new Array("blue","black"),M=D[0];L.polyline(p[z]).addTo(s).setStyle({color:M})}}async function S(){for(let p=0;p<t.length;p++){let D=await fetch(f+"/data/"+t[p].rtname),{data:M}=await D.json();b(M,t[p].rtname)}}function b(p,D){for(let M=0;M<p.length-1;M++){let z=parseFloat(p[M].lat),fe=parseFloat(p[M].lon);n.push(L.marker([z,fe]).addTo(s).bindPopup("A "+D+" bus with "+p[M].id+" direction "+p[M].bound))}}function m(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{d=[p.coords.latitude,p.coords.longitude],_()})}function _(){n.push(L.marker([d[0],d[1]],{icon:i}).addTo(s).bindPopup("Your Location").openPopup())}function v(p){console.log("load map"),f=p.host,t=p.r,s=L.map("map").setView([51.505,-.09],13),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(s),o=new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),i=new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),h()}return[$,h,v]}class ge extends N{constructor(e){super(),H(this,e,_e,me,C,{refreshBusData:1,refreshLocationData:0,load:2})}get refreshBusData(){return this.$$.ctx[1]}get refreshLocationData(){return this.$$.ctx[0]}get load(){return this.$$.ctx[2]}}function X(a,e,l){const t=a.slice();return t[6]=e[l],t}function Z(a,e,l){const t=a.slice();return t[9]=e[l],t}function x(a){let e,l;return e=new de({props:{bus:a[9]}}),{c(){re(e.$$.fragment)},l(t){se(e.$$.fragment,t)},m(t,n){ce(e,t,n),l=!0},p(t,n){const s={};n&1&&(s.bus=t[9]),e.$set(s)},i(t){l||(B(e.$$.fragment,t),l=!0)},o(t){V(e.$$.fragment,t),l=!1},d(t){ue(e,t)}}}function ee(a){let e,l,t,n,s,o,i,f,d=a[6].r,h=[];for(let c=0;c<d.length;c+=1)h[c]=x(Z(a,d,c));const $=c=>V(h[c],1,1,()=>{h[c]=null});return{c(){e=k("div"),l=k("p"),t=A("Route:"),n=T();for(let c=0;c<h.length;c+=1)h[c].c();s=T(),this.h()},l(c){e=w(c,"DIV",{class:!0});var u=I(e);l=w(u,"P",{});var r=I(l);t=q(r,"Route:"),r.forEach(g),n=E(u);for(let S=0;S<h.length;S+=1)h[S].l(u);s=E(u),u.forEach(g),this.h()},h(){R(e,"class","svelte-125laxq")},m(c,u){P(c,e,u),y(e,l),y(l,t),y(e,n);for(let r=0;r<h.length;r+=1)h[r]&&h[r].m(e,null);y(e,s),o=!0,i||(f=[j(e,"click",function(){ie(a[1](a[6]))&&a[1](a[6]).apply(this,arguments)}),j(e,"keypress",{})],i=!0)},p(c,u){if(a=c,u&1){d=a[6].r;let r;for(r=0;r<d.length;r+=1){const S=Z(a,d,r);h[r]?(h[r].p(S,u),B(h[r],1)):(h[r]=x(S),h[r].c(),B(h[r],1),h[r].m(e,s))}for(F(),r=d.length;r<h.length;r+=1)$(r);J()}},i(c){if(!o){for(let u=0;u<d.length;u+=1)B(h[u]);o=!0}},o(c){h=h.filter(Boolean);for(let u=0;u<h.length;u+=1)V(h[u]);o=!1},d(c){c&&g(e),K(h,c),i=!1,O(f)}}}function ve(a){let e,l,t=a[0],n=[];for(let o=0;o<t.length;o+=1)n[o]=ee(X(a,t,o));const s=o=>V(n[o],1,1,()=>{n[o]=null});return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Q()},l(o){for(let i=0;i<n.length;i+=1)n[i].l(o);e=Q()},m(o,i){for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(o,i);P(o,e,i),l=!0},p(o,[i]){if(i&3){t=o[0];let f;for(f=0;f<t.length;f+=1){const d=X(o,t,f);n[f]?(n[f].p(d,i),B(n[f],1)):(n[f]=ee(d),n[f].c(),B(n[f],1),n[f].m(e.parentNode,e))}for(F(),f=t.length;f<n.length;f+=1)s(f);J()}},i(o){if(!l){for(let i=0;i<t.length;i+=1)B(n[i]);l=!0}},o(o){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)V(n[i]);l=!1},d(o){K(n,o),o&&g(e)}}}function ye(a,e,l){let t=[],n=[],s="",o="";async function i(d){console.log("Start Load"),o=d.host,n=d.location,s=d.destination;let h=await fetch(o+"/dirs/?home="+n[0]+","+n[1]+"&dest="+s),{data:$}=await h.json();l(0,t=$)}async function f(d){console.log("here");var h=new ge({target:document.querySelector("#Map")});console.log("here2"),h.load({host:o,r:d.r}),console.log("here3"),l(0,t=[d])}return[t,f,i]}class be extends N{constructor(e){super(),H(this,e,ye,ve,C,{load:2})}get load(){return this.$$.ctx[2]}}function $e(a){let e,l=a[0].name+"",t;return{c(){e=k("h1"),t=A(l),this.h()},l(n){e=w(n,"H1",{class:!0});var s=I(e);t=q(s,l),s.forEach(g),this.h()},h(){R(e,"class","svelte-1c92o6y")},m(n,s){P(n,e,s),y(e,t)},p(n,[s]){s&1&&l!==(l=n[0].name+"")&&G(t,l)},i:U,o:U,d(n){n&&g(e)}}}function ke(a,e,l){let{destination:t}=e;return a.$$set=n=>{"destination"in n&&l(0,t=n.destination)},[t]}class we extends N{constructor(e){super(),H(this,e,ke,$e,C,{destination:0})}}function te(a,e,l){const t=a.slice();return t[3]=e[l],t}function oe(a){let e,l,t,n,s;return{c(){e=k("input"),l=T(),t=k("input"),this.h()},l(o){e=w(o,"INPUT",{type:!0}),l=E(o),t=w(o,"INPUT",{type:!0}),this.h()},h(){R(e,"type","text"),R(t,"type","button"),t.value="Search"},m(o,i){P(o,e,i),W(e,a[2]),P(o,l,i),P(o,t,i),n||(s=[j(e,"input",a[7]),j(t,"click",a[5])],n=!0)},p(o,i){i&4&&e.value!==o[2]&&W(e,o[2])},d(o){o&&g(e),o&&g(l),o&&g(t),n=!1,O(s)}}}function ne(a){let e,l,t,n,s;return l=new we({props:{destination:a[3]}}),{c(){e=k("div"),re(l.$$.fragment)},l(o){e=w(o,"DIV",{});var i=I(e);se(l.$$.fragment,i),i.forEach(g)},m(o,i){P(o,e,i),ce(l,e,null),t=!0,n||(s=[j(e,"click",function(){ie(a[4](a[3]))&&a[4](a[3]).apply(this,arguments)}),j(e,"keypress",{})],n=!0)},p(o,i){a=o;const f={};i&2&&(f.destination=a[3]),l.$set(f)},i(o){t||(B(l.$$.fragment,o),t=!0)},o(o){V(l.$$.fragment,o),t=!1},d(o){o&&g(e),ue(l),n=!1,O(s)}}}function le(a){let e,l,t;return{c(){e=k("input"),this.h()},l(n){e=w(n,"INPUT",{type:!0}),this.h()},h(){R(e,"type","button"),e.value="Go back to routes"},m(n,s){P(n,e,s),l||(t=j(e,"click",a[6]),l=!0)},p:U,d(n){n&&g(e),l=!1,t()}}}function Le(a){let e,l,t,n,s,o,i,f,d,h,$,c=a[0]==0&&oe(a),u=a[1],r=[];for(let m=0;m<u.length;m+=1)r[m]=ne(te(a,u,m));const S=m=>V(r[m],1,1,()=>{r[m]=null});let b=a[0]==1&&le(a);return{c(){e=k("main"),l=k("h1"),t=A("Main View"),n=T(),c&&c.c(),s=T();for(let m=0;m<r.length;m+=1)r[m].c();o=T(),b&&b.c(),i=T(),f=k("div"),d=T(),h=k("div"),this.h()},l(m){e=w(m,"MAIN",{});var _=I(e);l=w(_,"H1",{});var v=I(l);t=q(v,"Main View"),v.forEach(g),n=E(_),c&&c.l(_),s=E(_);for(let p=0;p<r.length;p+=1)r[p].l(_);o=E(_),b&&b.l(_),i=E(_),f=w(_,"DIV",{id:!0}),I(f).forEach(g),d=E(_),h=w(_,"DIV",{id:!0}),I(h).forEach(g),_.forEach(g),this.h()},h(){R(f,"id","Rts"),R(h,"id","Map")},m(m,_){P(m,e,_),y(e,l),y(l,t),y(e,n),c&&c.m(e,null),y(e,s);for(let v=0;v<r.length;v+=1)r[v]&&r[v].m(e,null);y(e,o),b&&b.m(e,null),y(e,i),y(e,f),y(e,d),y(e,h),$=!0},p(m,[_]){if(m[0]==0?c?c.p(m,_):(c=oe(m),c.c(),c.m(e,s)):c&&(c.d(1),c=null),_&18){u=m[1];let v;for(v=0;v<u.length;v+=1){const p=te(m,u,v);r[v]?(r[v].p(p,_),B(r[v],1)):(r[v]=ne(p),r[v].c(),B(r[v],1),r[v].m(e,o))}for(F(),v=u.length;v<r.length;v+=1)S(v);J()}m[0]==1?b?b.p(m,_):(b=le(m),b.c(),b.m(e,i)):b&&(b.d(1),b=null)},i(m){if(!$){for(let _=0;_<u.length;_+=1)B(r[_]);$=!0}},o(m){r=r.filter(Boolean);for(let _=0;_<r.length;_+=1)V(r[_]);$=!1},d(m){m&&g(e),c&&c.d(),K(r,m),b&&b.d()}}}let ae="https://deploy.thankfulsmoke-89b0f183.northeurope.azurecontainerapps.io";function Se(a,e,l){let t=0,n=[],s=[],o="",i="";function f(){navigator.geolocation?navigator.geolocation.getCurrentPosition(u=>{s=[u.coords.latitude,u.coords.longitude];var r=new be({target:document.querySelector("#Rts")});r.load({host:ae,location:s,destination:o}),l(0,t=1)}):alert("Geolocation is not supported by this browser.")}function d(u){l(3,o=u.id),console.log(u.id),l(1,n=[u]),f()}async function h(){let u=await fetch(ae+"/search/?dest="+i),{data:r}=await u.json();l(1,n=r)}function $(){f(),document.querySelector("#Map").innerHTML=""}function c(){i=this.value,l(2,i)}return[t,n,i,o,d,h,$,c]}class Ie extends N{constructor(e){super(),H(this,e,Se,Le,C,{})}}export{Ie as default};
